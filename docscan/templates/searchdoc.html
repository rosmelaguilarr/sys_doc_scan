{% extends 'layouts/nav.html' %}

{% block content %}

<main class="container">
    <div class="row">
        <section class="col-md-12 mt-3">
            <h1 class='text-center display-6 fs-2 mb-3' >Buscar documentos</h1>
            <form method='GET' class="card card-body flex-row justify-content-between align-items-center" >
                {% csrf_token %}
                <div class="mb-3">
                    <label for="doctype_search">Documento:</label>
                    <select name="doctype_search" class="select form-select" id="doctype_search">
                        <option value="" {% if not request.GET.doctype_search %}selected{% endif %}>Escoge documento</option>
                        {% for doctype in doctypes %}
                        <option value="{{ doctype.pk }}" {% if request.GET.doctype_search == doctype.pk|stringformat:"s" %}selected{% endif %}>{{ doctype.name }}</option>

                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label for="origin_search">Origen:</label>
                    <select name="origin_search" class="select form-select" id="origin_search">
                        <option value="" {% if not request.GET.origin_search %}selected{% endif %}>Escoge origen</option>
                        {% for origin in origins %}
                        <option value="{{ origin.pk }}" {% if request.GET.origin_search == origin.pk|stringformat:"s" %}selected{% endif %}>{{ origin.name }}</option>
                        {% endfor %}
                    </select>
                    
                </div>
                <div class="mb-3">
                    <label for="date_search">Fecha:</label>
                    <input type="date" name="date_search" id="date_search" 
                    class="form-control" value="{{ request.GET.date_search }}">
                </div>
                <div class="mb-3">
                    <label for="name_search">Descripción:</label>
                    <input type="text" name="name_search" id="name_search" 
                    class="form-control" value="{{ request.GET.name_search }}">
                </div>
                <div>
                    <button class='btn btn-primary' title="Buscar">
                        <i class="bi bi-search mx-1" style="font-size: 1rem;"></i>
                        Buscar
                    </button>
                    <a href="{% url 'searchdoc' %}" class="btn btn-secondary" title="Limpiar">
                        <i class="bi bi-eraser-fill" style="font-size: 1rem;"></i>
                    </a>
                </div>
            </form>
        </section>
        
        <section class="col-md-12 mt-3">
            {% if messages %}
                {% for msg in messages  %}
                    <div class="alert alert-success py-2 d-flex" role="alert">
                        <div class="mx-auto">
                            {{ msg }}
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <div class="card card-body">
                <table class="table table-hover">
                    <thead>
                        <tr>
                        <th scope="col">Acciones</th>
                        <th scope="col">Nombre</th>
                        <th scope="col">Documento</th>
                        <th scope="col">Orígen</th>
                        <th scope="col">Descripción</th>
                        <th scope="col">Fecha</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for document in page_obj %}
                            <tr>
                                <td>
                                    <a class="btn btn-outline-primary btn-sm" href=" {% url 'updatedoc' document.id %} ">
                                        <i class="bi bi-pencil-fill" title="Editar"></i>
                                    </a>
        
                                    <a class="btn btn-outline-danger btn-sm btn-delete" href=" {% url 'deletedoc' document.id %}" title="Eliminar">
                                        <i class="bi bi-trash-fill"></i>
                                    </a>
        
                                    <a class="btn btn-outline-primary btn-sm me-2" href="{% url 'previewdoc' doc_id=document.pk %}" target="_blank">
                                        <i class="bi bi-search"></i>
                                    </a>

                                </td>
                                <td>
                                    {% with file_path=document.fileupload %}
                                        {% with file_name=file_path|cut:"/"|slice:"7:" %}
                                            {{ file_name }}
                                        {% endwith %}
                                    {% endwith %}
                                </td>
                                <td> {{ document.doctype }} </td>
                                <td> {{ document.origin }} </td>
                                <td> {{ document.description }} </td>
                                <td> 
                                    {{ document.dateregister|date:"d/m/Y" }}
                                </td>
                            </tr>
                            {% empty %}
                            <div class="alert alert-warning text-center d-flex py-2" role="alert">
                                <i class="bi bi-info-circle-fill"></i>
                                <div class="mx-auto">
                                    No se encontraron documentos
                                </div>
                            </div>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        </section>
        
        <section class="my-3">
            {% if page_obj.has_other_pages %}
                {% include "pagination.html" %}
            {% endif %}
        </section>
    </div>
</main>

{% endblock %}
